<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>Dates.kt</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">site</a> &gt; <a href="index.source.html" class="el_package">com.hexagontk.core</a> &gt; <span class="el_source">Dates.kt</span></div><h1>Dates.kt</h1><pre class="source lang-java linenums">package com.hexagontk.core

import java.time.*
import java.util.Date

private const val DAYS_PER_MONTH: Double = 30.4375

/** GMT zone ID. */
<span class="fc" id="L9">val GMT_ZONE: ZoneId by lazy { ZoneId.of(&quot;GMT&quot;) }</span>

/**
 * Return the date time in a given time zone for a local date time.
 *
 * @receiver Local date time to be moved to another time zone.
 * @param zoneId Id of the target zone of the passed local date time.
 * @return Received date time at the given [zoneId].
 */
<span class="fc" id="L18">fun LocalDateTime.withZone(zoneId: ZoneId = Platform.timeZone.toZoneId()): ZonedDateTime =</span>
<span class="fc" id="L19">    ZonedDateTime.of(this, zoneId)</span>

/**
 * Convert a zoned date time to a date.
 *
 * @receiver Zoned date time to be converted to a date.
 * @return Date representation of the given zoned date time.
 */
fun ZonedDateTime.toDate(): Date =
<span class="fc" id="L28">    Date.from(this.toInstant())</span>

/**
 * Convert a local date time to a date.
 *
 * @receiver Local date time to be converted to a date.
 * @return Date representation of the given local date time.
 */
fun LocalDateTime.toDate(): Date =
<span class="fc" id="L37">    this.atZone(Platform.timeZone.toZoneId()).toDate()</span>

/**
 * Convert a local date to a date.
 *
 * @receiver Local date to be converted to a date.
 * @return Date representation of the given local date.
 */
fun LocalDate.toDate(): Date =
<span class="fc" id="L46">    this.atStartOfDay(Platform.timeZone.toZoneId()).toDate()</span>

/**
 * Convert a date to a local date time.
 *
 * @receiver Date to be converted to a local date time.
 * @return Local date time representation of the given date.
 */
fun Date.toLocalDateTime(): LocalDateTime =
<span class="fc" id="L55">    LocalDateTime.ofInstant(Instant.ofEpochMilli(this.time), ZoneId.systemDefault())</span>

/**
 * Convert a date to a local date.
 *
 * @receiver Date to be converted to a local date.
 * @return Local date representation of the given date.
 */
fun Date.toLocalDate(): LocalDate =
<span class="fc" id="L64">    this.toLocalDateTime().toLocalDate()</span>

/**
 * Calculate the aproximate number of days comprised in a time period.
 *
 * @receiver Period from which calculate the number of days.
 * @return Aproximate number of days of the period.
 */
fun Period.toTotalDays(): Double =
<span class="fc" id="L73">    (toTotalMonths() * DAYS_PER_MONTH) + days</span>

/**
 * Parse a time period allowing a more relaxed format: with spaces or commas, lowercase characters
 * and not forcing the text to start with 'P'.
 *
 * @param text Text to be parsed to a time period.
 * @return Time period parsed from the supplied text.
 */
fun parsePeriod(text: String): Period =
<span class="fc" id="L83">    Period.parse(formatDuration(text))</span>

/**
 * Parse a time duration allowing a more relaxed format: with spaces or commas, lowercase characters
 * and not forcing the text to start with 'P', however, the 'T' is still mandatory to separate date
 * and time durations.
 *
 * @param text Text to be parsed to a time duration.
 * @return Time duration parsed from the supplied text.
 */
fun parseDuration(text: String): Duration =
<span class="fc" id="L94">    Duration.parse(formatDuration(text))</span>

private fun formatDuration(text: String): String =
<span class="fc" id="L97">    text</span>
<span class="fc" id="L98">        .replace(&quot;,&quot;, &quot;&quot;)</span>
<span class="fc" id="L99">        .replace(&quot; &quot;, &quot;&quot;)</span>
<span class="fc" id="L100">        .uppercase()</span>
<span class="fc bfc" id="L101" title="All 2 branches covered.">        .let { if (it.startsWith(&quot;P&quot;)) it else &quot;P$it&quot; }</span>

/**
 * Parse a local date allowing only to specify the year or the year and the month. Missing month and
 * day will be defaulted to january and one respectively.
 *
 * @param text Text to be parsed to a local date.
 * @return Local date parsed from the supplied text.
 */
fun parseLocalDate(text: String): LocalDate =
<span class="fc bfc" id="L111" title="All 3 branches covered.">    when (text.length) {</span>
<span class="fc" id="L112">        4 -&gt; Year.parse(text).atMonth(1).atDay(1)</span>
<span class="fc" id="L113">        7 -&gt; YearMonth.parse(text).atDay(1)</span>
<span class="fc" id="L114">        else -&gt; LocalDate.parse(text)</span>
<span class="fc" id="L115">    }</span>
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.12.202403310830</span></div></body></html>