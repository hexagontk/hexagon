<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>Network.kt</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">site</a> &gt; <a href="index.source.html" class="el_package">com.hexagontk.core</a> &gt; <span class="el_source">Network.kt</span></div><h1>Network.kt</h1><pre class="source lang-java linenums">package com.hexagontk.core

import java.io.File
import java.net.*
import java.util.*

/** Internet address used to bind services to all local network interfaces. */
<span class="fc" id="L8">val ALL_INTERFACES: InetAddress by lazy { inetAddress(0, 0, 0, 0) }</span>

/** Internet address used to bind services to the loop-back interface. */
<span class="fc" id="L11">val LOOPBACK_INTERFACE: InetAddress by lazy { inetAddress(127, 0, 0, 1) }</span>

/**
 * Syntactic sugar to create an Internet address.
 *
 * @param bytes Bytes used in the address.
 * @return The Internet address corresponding with the supplied bytes.
 */
fun inetAddress(vararg bytes: Byte): InetAddress =
<span class="fc" id="L20">    InetAddress.getByAddress(bytes)</span>

/**
 * Return a random free port (not used by any other local process).
 *
 * @return Random free port number.
 */
fun freePort(): Int =
<span class="pc" id="L28">    ServerSocket(0).use { it.localPort }</span>

/**
 * Check if a port is already opened.
 *
 * @param port Port number to check.
 * @return True if the port is open, false otherwise.
 */
fun isPortOpened(port: Int): Boolean =
<span class="fc" id="L37">    try {</span>
<span class="pc" id="L38">        Socket(&quot;localhost&quot;, port).use { it.isConnected }</span>
    }
<span class="fc" id="L40">    catch (_: Exception) {</span>
<span class="fc" id="L41">        false</span>
<span class="fc" id="L42">    }</span>

fun urlOf(url: String): URL =
<span class="fc" id="L45">    URI(url).toURL()</span>

fun URL.responseCode(): Int =
<span class="fc" id="L48">    try {</span>
<span class="fc" id="L49">        (openConnection() as HttpURLConnection).responseCode</span>
    }
<span class="fc" id="L51">    catch (_: java.lang.Exception) {</span>
<span class="fc" id="L52">        400</span>
<span class="fc" id="L53">    }</span>

fun URL.responseSuccessful(): Boolean =
<span class="pc bpc" id="L56" title="1 of 4 branches missed.">    responseCode() in 200 until 300</span>

fun URL.responseFound(): Boolean =
<span class="pc bpc" id="L59" title="3 of 8 branches missed.">    responseCode().let { it in 200 until 500 &amp;&amp; it != 404 }</span>

// TODO Review the next functions, not all cases are covered
fun URL.exists(): Boolean =
<span class="pc bpc" id="L63" title="1 of 7 branches missed.">    when (protocol) {</span>
<span class="fc" id="L64">        &quot;http&quot; -&gt; responseSuccessful()</span>
<span class="fc" id="L65">        &quot;https&quot; -&gt; responseSuccessful()</span>
<span class="pc bpc" id="L66" title="1 of 4 branches missed.">        &quot;file&quot; -&gt; File(file).let { it.exists() &amp;&amp; !it.isDirectory }</span>
<span class="fc" id="L67">        &quot;classpath&quot; -&gt; try { openConnection(); true } catch (_: Exception) { false }</span>
<span class="fc" id="L68">        else -&gt; false</span>
<span class="fc" id="L69">    }</span>

fun URL.firstVariant(vararg suffixes: String): URL {
<span class="fc" id="L72">    val extension = file.substringAfter('.')</span>
<span class="fc" id="L73">    val fileName = file.removeSuffix(&quot;.$extension&quot;)</span>

<span class="fc" id="L75">    suffixes.forEach {</span>
<span class="fc" id="L76">        val u = urlOf(&quot;$protocol:$fileName$it.$extension&quot;)</span>
<span class="fc bfc" id="L77" title="All 2 branches covered.">        if (u.exists())</span>
<span class="fc" id="L78">            return u</span>
<span class="fc" id="L79">    }</span>

<span class="fc" id="L81">    return this</span>
}

fun URL.localized(locale: Locale): URL {
<span class="fc" id="L85">    val language = locale.language</span>
<span class="fc" id="L86">    val country = locale.country</span>
<span class="fc" id="L87">    return firstVariant(&quot;_${language}_$country&quot;, &quot;_${language}&quot;)</span>
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.12.202403310830</span></div></body></html>