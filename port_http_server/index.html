



<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      <meta http-equiv="x-ua-compatible" content="ie=edge">
      
        <meta name="description" content="The atoms of your platform">
      
      
        <link rel="canonical" href="https://hexagonkt.com/port_http_server/">
      
      
        <meta name="author" content="Juanjo Aguililla">
      
      
        <meta name="lang:clipboard.copy" content="Copy to clipboard">
      
        <meta name="lang:clipboard.copied" content="Copied to clipboard">
      
        <meta name="lang:search.language" content="en">
      
        <meta name="lang:search.pipeline.stopwords" content="True">
      
        <meta name="lang:search.pipeline.trimmer" content="True">
      
        <meta name="lang:search.result.none" content="No matching documents">
      
        <meta name="lang:search.result.one" content="1 matching document">
      
        <meta name="lang:search.result.other" content="# matching documents">
      
        <meta name="lang:search.tokenizer" content="[\s\-]+">
      
      <link rel="shortcut icon" href="../favicon.ico">
      <meta name="generator" content="mkdocs-1.0.4, mkdocs-material-4.6.3">
    
    
      
        <title>HTTP Server - Hexagon</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/application.adb8469c.css">
      
        <link rel="stylesheet" href="../assets/stylesheets/application-palette.a8b3c06d.css">
      
      
        
        
        <meta name="theme-color" content="#546691">
      
    
    
      <script src="../assets/javascripts/modernizr.86422ebf.js"></script>
    
    
      
        <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Titillium+Web:300,400,400i,700%7CRoboto+Mono&display=fallback">
        <style>body,input{font-family:"Titillium Web","Helvetica Neue",Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono","Courier New",Courier,monospace}</style>
      
    
    <link rel="stylesheet" href="../assets/fonts/material-icons.css">
    
    
      <link rel="stylesheet" href="../css/mkdocs_palette.css">
    
      <link rel="stylesheet" href="../css/mkdocs.css">
    
    
      
        
<script>
  window.ga = window.ga || function() {
    (ga.q = ga.q || []).push(arguments)
  }
  ga.l = +new Date
  /* Setup integration and send page view */
  ga("create", "UA-48216810-3", "auto")
  ga("set", "anonymizeIp", true)
  ga("send", "pageview")
  /* Register handler to log search on blur */
  document.addEventListener("DOMContentLoaded", () => {
    if (document.forms.search) {
      var query = document.forms.search.query
      query.addEventListener("blur", function() {
        if (this.value) {
          var path = document.location.pathname;
          ga("send", "pageview", path + "?q=" + this.value)
        }
      })
    }
  })
</script>
<script async src="https://www.google-analytics.com/analytics.js"></script>
      
    
    
<meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>

<meta name="keywords" content="Hexagon, microservices, Kotlin, RabbitMQ, MongoDB, JVM, Web" />
<meta name="application-name" content="Hexagon" />
<meta name="theme-color" content="#135AA1" />

<meta name="msapplication-navbutton-color" content="#135AA1" />
<meta name="msapplication-config" content="/browserconfig.xml">
<meta name="msapplication-TileColor" content="#135AA1">
<meta name="msapplication-TileImage" content="/apple-touch-icon.png">

<meta name="apple-mobile-web-app-status-bar-style" content="#135AA1" />
<meta name="apple-mobile-web-app-capable" content="yes" />
<meta name="mobile-web-app-capable" content="yes" />

<link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png" />
<link rel="icon" sizes="16x16 32x32 64x64" href="/favicon.ico">

<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:site" content="@hexagon_kt">
<meta name="twitter:creator" content="@hexagon_kt">
<meta name="twitter:title" content="Hexagon">
<meta name="twitter:description" content="Hexagon is a microservices toolkit written in Kotlin. Its purpose is to ease the building of services (Web applications, APIs or queue consumers) that run inside a cloud platform
">
<meta name="twitter:image" content="https://hexagonkt.comapple-touch-icon.png">

<meta property="og:title" content="Hexagon" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://hexagonkt.com" />
<meta property="og:image" content="https://hexagonkt.comapple-touch-icon.png" />
<meta property="og:description" content="Hexagon is a microservices toolkit written in Kotlin. Its purpose is to ease the building of services (Web applications, APIs or queue consumers) that run inside a cloud platform
" />

<meta itemprop="name" content="Hexagon">
<meta itemprop="description" content="Hexagon is a microservices toolkit written in Kotlin. Its purpose is to ease the building of services (Web applications, APIs or queue consumers) that run inside a cloud platform
 ">
<meta itemprop="image" content="https://hexagonkt.comapple-touch-icon.png">

<link rel="author" href="/humans.txt" />
<link rel="manifest" href="/manifest.json">

<!-- Web worker -->
<!--
<script>
if ('serviceWorker' in navigator)
  navigator.serviceWorker
    .register('/service_worker.js')
    .then(function() { console.log('Worker Registered'); });
</script>
-->

  </head>
  
    
    
    <body dir="ltr" data-md-color-primary="indigo" data-md-color-accent="indigo">
  
    <svg class="md-svg">
      <defs>
        
        
          <svg xmlns="http://www.w3.org/2000/svg" width="416" height="448" viewBox="0 0 416 448" id="__github"><path fill="currentColor" d="M160 304q0 10-3.125 20.5t-10.75 19T128 352t-18.125-8.5-10.75-19T96 304t3.125-20.5 10.75-19T128 256t18.125 8.5 10.75 19T160 304zm160 0q0 10-3.125 20.5t-10.75 19T288 352t-18.125-8.5-10.75-19T256 304t3.125-20.5 10.75-19T288 256t18.125 8.5 10.75 19T320 304zm40 0q0-30-17.25-51T296 232q-10.25 0-48.75 5.25Q229.5 240 208 240t-39.25-2.75Q130.75 232 120 232q-29.5 0-46.75 21T56 304q0 22 8 38.375t20.25 25.75 30.5 15 35 7.375 37.25 1.75h42q20.5 0 37.25-1.75t35-7.375 30.5-15 20.25-25.75T360 304zm56-44q0 51.75-15.25 82.75-9.5 19.25-26.375 33.25t-35.25 21.5-42.5 11.875-42.875 5.5T212 416q-19.5 0-35.5-.75t-36.875-3.125-38.125-7.5-34.25-12.875T37 371.5t-21.5-28.75Q0 312 0 260q0-59.25 34-99-6.75-20.5-6.75-42.5 0-29 12.75-54.5 27 0 47.5 9.875t47.25 30.875Q171.5 96 212 96q37 0 70 8 26.25-20.5 46.75-30.25T376 64q12.75 25.5 12.75 54.5 0 21.75-6.75 42 34 40 34 99.5z"/></svg>
        
      </defs>
    </svg>
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" data-md-component="overlay" for="__drawer"></label>
    
      <a href="#server" tabindex="0" class="md-skip">
        Skip to content
      </a>
    
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid">
    <div class="md-flex">
      <div class="md-flex__cell md-flex__cell--shrink">
        <a href="https://hexagonkt.com" title="Hexagon" aria-label="Hexagon" class="md-header-nav__button md-logo">
          
            <img alt="logo" src="../img/logo_white.svg" width="24" height="24">
          
        </a>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        <label class="md-icon md-icon--menu md-header-nav__button" for="__drawer"></label>
      </div>
      <div class="md-flex__cell md-flex__cell--stretch">
        <div class="md-flex__ellipsis md-header-nav__title" data-md-component="title">
          
            <span class="md-header-nav__topic">
              Hexagon
            </span>
            <span class="md-header-nav__topic">
              
                HTTP Server
              
            </span>
          
        </div>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        
          <label class="md-icon md-icon--search md-header-nav__button" for="__search"></label>
          
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" aria-label="search" name="query" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="query" data-md-state="active">
      <label class="md-icon md-search__icon" for="__search"></label>
      <button type="reset" class="md-icon md-search__icon" data-md-component="reset" tabindex="-1">
        &#xE5CD;
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="result">
          <div class="md-search-result__meta">
            Type to start searching
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
        
      </div>
      
        <div class="md-flex__cell md-flex__cell--shrink">
          <div class="md-header-nav__source">
            


  

<a href="https://github.com/hexagonkt/hexagon/" title="Go to repository" class="md-source" data-md-source="github">
  
    <div class="md-source__icon">
      <svg viewBox="0 0 24 24" width="24" height="24">
        <use xlink:href="#__github" width="24" height="24"></use>
      </svg>
    </div>
  
  <div class="md-source__repository">
    GitHub
  </div>
</a>
          </div>
        </div>
      
    </div>
  </nav>
</header>
    
    <div class="md-container">
      
        
      
      
        

  

<nav class="md-tabs md-tabs--active" data-md-component="tabs">
  <div class="md-tabs__inner md-grid">
    <ul class="md-tabs__list">
      
        
  
  
    <li class="md-tabs__item">
      
        <a href=".." class="md-tabs__link">
          Getting Started
        </a>
      
    </li>
  

      
        
  
  
    
    
  
  
    <li class="md-tabs__item">
      
        <a href="../hexagon_core/" class="md-tabs__link">
          Documentation
        </a>
      
    </li>
  

  

      
        
  
  
    <li class="md-tabs__item">
      
        <a href="../examples/example_projects/" class="md-tabs__link">
          Examples
        </a>
      
    </li>
  

      
        
  
  
    <li class="md-tabs__item">
      
        <a href="../help/" class="md-tabs__link">
          Community
        </a>
      
    </li>
  

      
    </ul>
  </div>
</nav>
      
      <main class="md-main" role="main">
        <div class="md-main__inner md-grid" data-md-component="container">
          
            
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    <nav class="md-nav md-nav--primary" data-md-level="0">
  <label class="md-nav__title md-nav__title--site" for="__drawer">
    <a href="https://hexagonkt.com" title="Hexagon" class="md-nav__button md-logo">
      
        <img alt="logo" src="../img/logo_white.svg" width="48" height="48">
      
    </a>
    Hexagon
  </label>
  
    <div class="md-nav__source">
      


  

<a href="https://github.com/hexagonkt/hexagon/" title="Go to repository" class="md-source" data-md-source="github">
  
    <div class="md-source__icon">
      <svg viewBox="0 0 24 24" width="24" height="24">
        <use xlink:href="#__github" width="24" height="24"></use>
      </svg>
    </div>
  
  <div class="md-source__repository">
    GitHub
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-1" type="checkbox" id="nav-1">
    
    <label class="md-nav__link" for="nav-1">
      Getting Started
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-1">
        Getting Started
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href=".." title="Home" class="md-nav__link">
      Home
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../quick_start/" title="Quick Start" class="md-nav__link">
      Quick Start
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../developer_guide/" title="Developer Guide" class="md-nav__link">
      Developer Guide
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../hexagon_core/hexagon_core/" title="Core" class="md-nav__link">
      Core
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="port_http_server/" title="HTTP Server" class="md-nav__link">
      HTTP Server
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../port_http_client/port_http_client/" title="HTTP Client" class="md-nav__link">
      HTTP Client
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../create_applications/" title="Create Applications" class="md-nav__link">
      Create Applications
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../gradle/" title="Gradle Helpers" class="md-nav__link">
      Gradle Helpers
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      

  


  <li class="md-nav__item md-nav__item--active md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-2" type="checkbox" id="nav-2" checked>
    
    <label class="md-nav__link" for="nav-2">
      Documentation
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-2">
        Documentation
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-2-1" type="checkbox" id="nav-2-1">
    
    <label class="md-nav__link" for="nav-2-1">
      Modules
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-2-1">
        Modules
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../hexagon_core/" title="Core" class="md-nav__link">
      Core
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../hexagon_scheduler/" title="Scheduler" class="md-nav__link">
      Scheduler
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../hexagon_web/" title="Web" class="md-nav__link">
      Web
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          

  


  <li class="md-nav__item md-nav__item--active md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-2-2" type="checkbox" id="nav-2-2" checked>
    
    <label class="md-nav__link" for="nav-2-2">
      Ports
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-2-2">
        Ports
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          

  


  <li class="md-nav__item md-nav__item--active">
    
    <input class="md-toggle md-nav__toggle" data-md-toggle="toc" type="checkbox" id="__toc">
    
    
      <label class="md-nav__link md-nav__link--active" for="__toc">
        HTTP Server
      </label>
    
    <a href="./" title="HTTP Server" class="md-nav__link md-nav__link--active">
      HTTP Server
    </a>
    
      
<nav class="md-nav md-nav--secondary">
  
  
  
    <label class="md-nav__title" for="__toc">Page Contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#server" class="md-nav__link">
    Server
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#servlet-web-server" class="md-nav__link">
    Servlet Web server
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#routes" class="md-nav__link">
    Routes
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#route-groups" class="md-nav__link">
    Route groups
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#routers" class="md-nav__link">
    Routers
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#callbacks" class="md-nav__link">
    Callbacks
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#call" class="md-nav__link">
    Call
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#request" class="md-nav__link">
    Request
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#path-parameters" class="md-nav__link">
    Path Parameters
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#query-parameters" class="md-nav__link">
    Query Parameters
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#form-parameters" class="md-nav__link">
    Form Parameters
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#file-uploads" class="md-nav__link">
    File Uploads
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#response" class="md-nav__link">
    Response
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#redirects" class="md-nav__link">
    Redirects
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#cookies" class="md-nav__link">
    Cookies
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#sessions" class="md-nav__link">
    Sessions
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#halting" class="md-nav__link">
    Halting
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#filters" class="md-nav__link">
    Filters
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#error-handling" class="md-nav__link">
    Error Handling
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#http-errors-handlers" class="md-nav__link">
    HTTP Errors Handlers
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#exception-mapping" class="md-nav__link">
    Exception Mapping
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#static-files" class="md-nav__link">
    Static Files
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#mime-types" class="md-nav__link">
    MIME types
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#cors" class="md-nav__link">
    CORS
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#https" class="md-nav__link">
    HTTPS
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#testing" class="md-nav__link">
    Testing
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#integration-tests" class="md-nav__link">
    Integration tests
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#mocking-calls" class="md-nav__link">
    Mocking calls
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#packages" class="md-nav__link">
    Packages
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#index" class="md-nav__link">
    Index
  </a>
  
</li>
      
      
      
      
      
        <li class="md-nav__item">
          <a href="#__comments" class="md-nav__link md-nav__link--active">
            Comments
          </a>
        </li>
      
    </ul>
  
</nav>
    
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../port_http_client/" title="HTTP Client" class="md-nav__link">
      HTTP Client
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../port_templates/" title="Templates" class="md-nav__link">
      Templates
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../port_store/" title="Store (beta)" class="md-nav__link">
      Store (beta)
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../port_messaging/" title="Messaging (beta)" class="md-nav__link">
      Messaging (beta)
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-2-3" type="checkbox" id="nav-2-3">
    
    <label class="md-nav__link" for="nav-2-3">
      Adapters
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-2-3">
        Adapters
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-2-3-1" type="checkbox" id="nav-2-3-1">
    
    <label class="md-nav__link" for="nav-2-3-1">
      HTTP Server
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="3">
      <label class="md-nav__title" for="nav-2-3-1">
        HTTP Server
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../http_server_jetty/" title="Jetty" class="md-nav__link">
      Jetty
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../http_server_servlet/" title="Servlet" class="md-nav__link">
      Servlet
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-2-3-2" type="checkbox" id="nav-2-3-2">
    
    <label class="md-nav__link" for="nav-2-3-2">
      HTTP Client
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="3">
      <label class="md-nav__title" for="nav-2-3-2">
        HTTP Client
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../http_client_ahc/" title="Async HTTP Client" class="md-nav__link">
      Async HTTP Client
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-2-3-3" type="checkbox" id="nav-2-3-3">
    
    <label class="md-nav__link" for="nav-2-3-3">
      Templates
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="3">
      <label class="md-nav__title" for="nav-2-3-3">
        Templates
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../templates_pebble/" title="Pebble" class="md-nav__link">
      Pebble
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../templates_freemarker/" title="FreeMarker" class="md-nav__link">
      FreeMarker
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-2-3-4" type="checkbox" id="nav-2-3-4">
    
    <label class="md-nav__link" for="nav-2-3-4">
      Store (beta)
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="3">
      <label class="md-nav__title" for="nav-2-3-4">
        Store (beta)
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../store_mongodb/" title="MongoDB (beta)" class="md-nav__link">
      MongoDB (beta)
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-2-3-5" type="checkbox" id="nav-2-3-5">
    
    <label class="md-nav__link" for="nav-2-3-5">
      Messaging (beta)
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="3">
      <label class="md-nav__title" for="nav-2-3-5">
        Messaging (beta)
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../messaging_rabbitmq/" title="RabbitMQ (beta)" class="md-nav__link">
      RabbitMQ (beta)
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../api/" title="API" class="md-nav__link">
      API
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-3" type="checkbox" id="nav-3">
    
    <label class="md-nav__link" for="nav-3">
      Examples
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-3">
        Examples
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../examples/example_projects/" title="Example Projects" class="md-nav__link">
      Example Projects
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-3-2" type="checkbox" id="nav-3-2">
    
    <label class="md-nav__link" for="nav-3-2">
      Code Examples
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-3-2">
        Code Examples
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../examples/http_server_examples/" title="HTTP Server" class="md-nav__link">
      HTTP Server
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../examples/http_client_examples/" title="HTTP Client" class="md-nav__link">
      HTTP Client
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-4" type="checkbox" id="nav-4">
    
    <label class="md-nav__link" for="nav-4">
      Community
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-4">
        Community
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../help/" title="Help and Support" class="md-nav__link">
      Help and Support
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="https://dev.to/hexagonkt" title="Dev.to ↗" class="md-nav__link">
      Dev.to ↗
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="https://kotlin.libhunt.com/hexagon-alternatives" title="LibHunt ↗" class="md-nav__link">
      LibHunt ↗
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="https://stackshare.io/hexagon" title="StackShare ↗" class="md-nav__link">
      StackShare ↗
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="https://github.com/hexagonkt/hexagon/blob/master/contributing.md" title="Contributing ↗" class="md-nav__link">
      Contributing ↗
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="https://github.com/hexagonkt/hexagon/projects/1" title="Planning ↗" class="md-nav__link">
      Planning ↗
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="https://github.com/hexagonkt/hexagon/milestones" title="Roadmap ↗" class="md-nav__link">
      Roadmap ↗
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="https://github.com/hexagonkt" title="Organization ↗" class="md-nav__link">
      Organization ↗
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary">
  
  
  
    <label class="md-nav__title" for="__toc">Page Contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#server" class="md-nav__link">
    Server
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#servlet-web-server" class="md-nav__link">
    Servlet Web server
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#routes" class="md-nav__link">
    Routes
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#route-groups" class="md-nav__link">
    Route groups
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#routers" class="md-nav__link">
    Routers
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#callbacks" class="md-nav__link">
    Callbacks
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#call" class="md-nav__link">
    Call
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#request" class="md-nav__link">
    Request
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#path-parameters" class="md-nav__link">
    Path Parameters
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#query-parameters" class="md-nav__link">
    Query Parameters
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#form-parameters" class="md-nav__link">
    Form Parameters
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#file-uploads" class="md-nav__link">
    File Uploads
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#response" class="md-nav__link">
    Response
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#redirects" class="md-nav__link">
    Redirects
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#cookies" class="md-nav__link">
    Cookies
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#sessions" class="md-nav__link">
    Sessions
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#halting" class="md-nav__link">
    Halting
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#filters" class="md-nav__link">
    Filters
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#error-handling" class="md-nav__link">
    Error Handling
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#http-errors-handlers" class="md-nav__link">
    HTTP Errors Handlers
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#exception-mapping" class="md-nav__link">
    Exception Mapping
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#static-files" class="md-nav__link">
    Static Files
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#mime-types" class="md-nav__link">
    MIME types
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#cors" class="md-nav__link">
    CORS
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#https" class="md-nav__link">
    HTTPS
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#testing" class="md-nav__link">
    Testing
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#integration-tests" class="md-nav__link">
    Integration tests
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#mocking-calls" class="md-nav__link">
    Mocking calls
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#packages" class="md-nav__link">
    Packages
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#index" class="md-nav__link">
    Index
  </a>
  
</li>
      
      
      
      
      
        <li class="md-nav__item">
          <a href="#__comments" class="md-nav__link md-nav__link--active">
            Comments
          </a>
        </li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
  
    <a href="https://github.com/hexagonkt/hexagon/edit/develop/port_http_server/README.md" title="Edit this page" class="md-icon md-content__icon">&#xE3C9;</a>
  
  
    <h1>HTTP Server</h1>
  
  <p><a href="./">port_http_server</a></p>
<p>This port's purpose is to develop HTTP servers (REST services or Web applications). It defines a DSL
to declare HTTP request handlers.</p>
<p>Adapters implementing this port are responsible of transforming the DSL into a runtime. And allows
you to switch implementations without changing the service.</p>
<p>The <a href="/hexagon_web">hexagon_web</a> module provides utilities on top of this port for Web application development
(like templates helpers).</p>
<h4 id="server">Server<a class="headerlink" href="#server" title="Permanent link">&para;</a></h4>
<p>A server is a process listening to HTTP requests on a TCP port.</p>
<p>You can run multiple ones on different ports at the same time (this can be useful to test many
microservices at the same time).</p>
<p>The server can be configured with different properties. If you do not provide a value for them, they
are searched inside the application settings and lastly, a default value is picked. This is the
parameters list:</p>
<ul>
<li>serviceName: name of this service, it is only informative and it is displayed on the logs. If not
  set <code class="codehilite"><span class="err">&lt;undefined&gt;</span></code> is used.</li>
<li>bindAddress: address to which this process is bound. If none is provided, <code class="codehilite"><span class="err">127.0.0.1</span></code> is taken.</li>
<li>bindPort: the port that the process listens to. By default it is <code class="codehilite"><span class="err">2010</span></code></li>
<li>contextPath: initial path used for the rest of the routes, by default it is empty.</li>
</ul>
<p>You can inject an adapter for the <code class="codehilite"><span class="err">Server</span></code> port using the <a href="/hexagon_core/#dependency-injection">InjectionManager</a> object:
<code class="codehilite"><span class="err">InjectionManager.bindObject&lt;ServerPort&gt;(JettyServletAdapter())</span></code></p>
<p>To create a server, you need to provide a router (check the <a href="/port_http_server/#routes">next section</a> for more information),
and after creating a server you can run it or stop it with <a href="com.hexagonkt.http.server/-server/start/">start</a> and <a href="com.hexagonkt.http.server/-server/stop/">stop</a> methods.</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><code><span class="cm">/*</span>
<span class="cm"> * All settings are optional, you can supply any combination</span>
<span class="cm"> * Parameters not set will fall back to the defaults</span>
<span class="cm"> */</span>
<span class="k">val</span> <span class="py">settings</span> <span class="p">=</span> <span class="n">ServerSettings</span><span class="p">(</span>
    <span class="n">serverName</span> <span class="p">=</span> <span class="s">&quot;name&quot;</span><span class="p">,</span>
    <span class="n">bindAddress</span> <span class="p">=</span> <span class="n">InetAddress</span><span class="p">.</span><span class="n">getByName</span><span class="p">(</span><span class="s">&quot;0.0.0&quot;</span><span class="p">),</span>
    <span class="n">bindPort</span> <span class="p">=</span> <span class="m">2020</span><span class="p">,</span>
    <span class="n">contextPath</span> <span class="p">=</span> <span class="s">&quot;/context&quot;</span>
<span class="p">)</span>

<span class="k">val</span> <span class="py">router</span> <span class="p">=</span> <span class="n">Router</span> <span class="p">{</span>
    <span class="k">get</span><span class="p">(</span><span class="s">&quot;/hello&quot;</span><span class="p">)</span> <span class="p">{</span> <span class="n">ok</span><span class="p">(</span><span class="s">&quot;Hello World!&quot;</span><span class="p">)</span> <span class="p">}</span>
<span class="p">}</span>

<span class="k">val</span> <span class="py">customServer</span> <span class="p">=</span> <span class="n">Server</span><span class="p">(</span><span class="n">adapter</span><span class="p">,</span> <span class="n">router</span><span class="p">,</span> <span class="n">settings</span><span class="p">)</span>

<span class="n">customServer</span><span class="p">.</span><span class="n">start</span><span class="p">()</span>

<span class="k">val</span> <span class="py">customClient</span> <span class="p">=</span> <span class="n">Client</span><span class="p">(</span><span class="n">AhcAdapter</span><span class="p">(),</span> <span class="s">&quot;http://localhost:${customServer.runtimePort}&quot;</span><span class="p">)</span>
<span class="n">assert</span><span class="p">(</span><span class="n">customServer</span><span class="p">.</span><span class="n">started</span><span class="p">())</span>
<span class="n">assert</span><span class="p">(</span><span class="n">customClient</span><span class="p">.</span><span class="k">get</span><span class="p">(</span><span class="s">&quot;/context/hello&quot;</span><span class="p">).</span><span class="n">body</span> <span class="p">==</span> <span class="s">&quot;Hello World!&quot;</span><span class="p">)</span>

<span class="n">customServer</span><span class="p">.</span><span class="n">stop</span><span class="p">()</span>

<span class="cm">/*</span>
<span class="cm"> * You can skip the adapter is you previously bound one</span>
<span class="cm"> * You may also skip the settings an the defaults will be used</span>
<span class="cm"> */</span>
<span class="n">InjectionManager</span><span class="p">.</span><span class="n">bindObject</span><span class="p">(</span><span class="n">adapter</span><span class="p">)</span>
<span class="k">val</span> <span class="py">defaultServer</span> <span class="p">=</span> <span class="n">Server</span><span class="p">(</span><span class="n">router</span> <span class="p">=</span> <span class="n">router</span><span class="p">)</span>

<span class="n">defaultServer</span><span class="p">.</span><span class="n">start</span><span class="p">()</span>

<span class="k">val</span> <span class="py">defaultClient</span> <span class="p">=</span> <span class="n">Client</span><span class="p">(</span><span class="n">AhcAdapter</span><span class="p">(),</span> <span class="s">&quot;http://localhost:${defaultServer.runtimePort}&quot;</span><span class="p">)</span>
<span class="n">assert</span><span class="p">(</span><span class="n">defaultServer</span><span class="p">.</span><span class="n">started</span><span class="p">())</span>
<span class="n">assert</span><span class="p">(</span><span class="n">defaultClient</span><span class="p">.</span><span class="k">get</span><span class="p">(</span><span class="s">&quot;/hello&quot;</span><span class="p">).</span><span class="n">body</span> <span class="p">==</span> <span class="s">&quot;Hello World!&quot;</span><span class="p">)</span>

<span class="n">defaultServer</span><span class="p">.</span><span class="n">stop</span><span class="p">()</span>
</code></pre></div>
</td></tr></table>

<h5 id="servlet-web-server">Servlet Web server<a class="headerlink" href="#servlet-web-server" title="Permanent link">&para;</a></h5>
<p>There is an special server adapter for running inside Servlet Containers. To use it you should
import the <a href="/http_server_servlet">Servlet HTTP Server Adapter</a> into your project. Check the
<a href="/http_server_servlet">http_server_servlet</a> module for more information.</p>
<h4 id="routes">Routes<a class="headerlink" href="#routes" title="Permanent link">&para;</a></h4>
<p>The main building block of a Hexagon HTTP service is a set of routes. A route is made up of three
simple pieces:</p>
<ul>
<li>A <strong>verb</strong> (get, post, put, delete, head, trace, connect, options). It can also be <code class="codehilite"><span class="err">any</span></code>.</li>
<li>A <strong>path</strong> (/hello, /users/{name}). Paths must start with '/' and trailing slash is ignored.</li>
<li>A <strong>callback</strong> code block.</li>
</ul>
<p>The callback has a void return type. You should use <code class="codehilite"><span class="err">Call.send()</span></code> to set the response which will
be returned to the user.</p>
<p>Routes are matched in the order they are defined. The first route that matches the request is
invoked and the following ones are ignored.</p>
<p>Check the next snippet for usage examples:</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2
3
4
5
6
7</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><code><span class="k">get</span><span class="p">(</span><span class="s">&quot;/hello&quot;</span><span class="p">)</span> <span class="p">{</span> <span class="n">ok</span><span class="p">(</span><span class="s">&quot;Get greeting&quot;</span><span class="p">)}</span>
<span class="n">put</span><span class="p">(</span><span class="s">&quot;/hello&quot;</span><span class="p">)</span> <span class="p">{</span> <span class="n">ok</span><span class="p">(</span><span class="s">&quot;Put greeting&quot;</span><span class="p">)}</span>
<span class="n">post</span><span class="p">(</span><span class="s">&quot;/hello&quot;</span><span class="p">)</span> <span class="p">{</span> <span class="n">ok</span><span class="p">(</span><span class="s">&quot;Post greeting&quot;</span><span class="p">)}</span>

<span class="n">any</span><span class="p">(</span><span class="s">&quot;/hello&quot;</span><span class="p">)</span> <span class="p">{</span> <span class="n">ok</span><span class="p">(</span><span class="s">&quot;Fallback if HTTP verb was not used before&quot;</span><span class="p">)}</span>

<span class="k">get</span> <span class="p">{</span> <span class="n">ok</span><span class="p">(</span><span class="s">&quot;Get at &#39;/&#39; if no route matched before&quot;</span><span class="p">)</span> <span class="p">}</span>
</code></pre></div>
</td></tr></table>

<p>HTTP clients will be able to reuse the routes to create REST services clients.</p>
<h5 id="route-groups">Route groups<a class="headerlink" href="#route-groups" title="Permanent link">&para;</a></h5>
<p>Routes can be nested by calling the <code class="codehilite"><span class="err">path()</span></code> method, which takes a String prefix and gives you a
scope to declare routes and filters (or more nested paths). Ie:</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2
3
4
5
6
7
8
9</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><code><span class="n">path</span><span class="p">(</span><span class="s">&quot;/nested&quot;</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">get</span><span class="p">(</span><span class="s">&quot;/hello&quot;</span><span class="p">)</span> <span class="p">{</span> <span class="n">ok</span><span class="p">(</span><span class="s">&quot;Greeting&quot;</span><span class="p">)}</span>

    <span class="n">path</span><span class="p">(</span><span class="s">&quot;/secondLevel&quot;</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">get</span><span class="p">(</span><span class="s">&quot;/hello&quot;</span><span class="p">)</span> <span class="p">{</span> <span class="n">ok</span><span class="p">(</span><span class="s">&quot;Second level greeting&quot;</span><span class="p">)}</span>
    <span class="p">}</span>

    <span class="k">get</span> <span class="p">{</span> <span class="n">ok</span><span class="p">(</span><span class="s">&quot;Get at &#39;/nested&#39;&quot;</span><span class="p">)</span> <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
</td></tr></table>

<h5 id="routers">Routers<a class="headerlink" href="#routers" title="Permanent link">&para;</a></h5>
<p>If you have a lot of routes, it can be helpful to group them into routers. You can create routers
to mount a group of routes in different paths (allowing you to reuse them). Check this snippet:</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span> 1
 2
 3
 4
 5
 6
 7
 8
 9
10</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><code><span class="k">fun</span> <span class="nf">personRouter</span><span class="p">(</span><span class="n">kind</span><span class="p">:</span> <span class="n">String</span><span class="p">)</span> <span class="p">=</span> <span class="n">Router</span> <span class="p">{</span>
    <span class="k">get</span> <span class="p">{</span> <span class="n">ok</span><span class="p">(</span><span class="s">&quot;Get $kind&quot;</span><span class="p">)</span> <span class="p">}</span>
    <span class="n">put</span> <span class="p">{</span> <span class="n">ok</span><span class="p">(</span><span class="s">&quot;Put $kind&quot;</span><span class="p">)</span> <span class="p">}</span>
    <span class="n">post</span> <span class="p">{</span> <span class="n">ok</span><span class="p">(</span><span class="s">&quot;Post $kind&quot;</span><span class="p">)</span> <span class="p">}</span>
<span class="p">}</span>

<span class="k">val</span> <span class="py">server</span> <span class="p">=</span> <span class="n">Server</span><span class="p">(</span><span class="n">adapter</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">path</span><span class="p">(</span><span class="s">&quot;/clients&quot;</span><span class="p">,</span> <span class="n">personRouter</span><span class="p">(</span><span class="s">&quot;client&quot;</span><span class="p">))</span>
    <span class="n">path</span><span class="p">(</span><span class="s">&quot;/customers&quot;</span><span class="p">,</span> <span class="n">personRouter</span><span class="p">(</span><span class="s">&quot;customer&quot;</span><span class="p">))</span>
<span class="p">}</span>
</code></pre></div>
</td></tr></table>

<h4 id="callbacks">Callbacks<a class="headerlink" href="#callbacks" title="Permanent link">&para;</a></h4>
<p>Callbacks are request's handling blocks that are bound to routes or filters. They make the request,
response and session objects available to the handling code.</p>
<h5 id="call">Call<a class="headerlink" href="#call" title="Permanent link">&para;</a></h5>
<p>The Call object provides you with everything you need to handle a http-request.</p>
<p>It contains the underlying request and response, and a bunch of utility methods to return results,
read parameters or pass attributes among filters/routes.</p>
<p>The methods are available directly from the callback (<code class="codehilite"><span class="err">Call</span></code> is the callback receiver). You can
check the <a href="/port_http_server/com.hexagonkt.http.server/-call/">API documentation</a> for the full list of methods.</p>
<p>This sample code illustrates the usage:</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2
3
4
5
6
7
8</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><code><span class="k">get</span><span class="p">(</span><span class="s">&quot;/call&quot;</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">attributes</span>                   <span class="c1">// the attributes list</span>
    <span class="n">attributes</span><span class="p">[</span><span class="s">&quot;foo&quot;</span><span class="p">]</span>            <span class="c1">// value of foo attribute</span>
    <span class="n">attributes</span><span class="p">[</span><span class="s">&quot;A&quot;</span><span class="p">]</span> <span class="p">=</span> <span class="s">&quot;V&quot;</span>        <span class="c1">// sets value of attribute A to V</span>

    <span class="n">ok</span><span class="p">(</span><span class="s">&quot;Response body&quot;</span><span class="p">)</span>          <span class="c1">// returns a 200 status</span>
    <span class="n">send</span><span class="p">(</span><span class="m">400</span><span class="p">,</span> <span class="s">&quot;Invalid request&quot;</span><span class="p">)</span> <span class="c1">// returns any status</span>
<span class="p">}</span>
</code></pre></div>
</td></tr></table>

<h5 id="request">Request<a class="headerlink" href="#request" title="Permanent link">&para;</a></h5>
<p>Request functionality is provided by the <code class="codehilite"><span class="err">request</span></code> field:</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><code><span class="k">get</span><span class="p">(</span><span class="s">&quot;/request&quot;</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// URL Information</span>
    <span class="n">request</span><span class="p">.</span><span class="n">method</span>                   <span class="c1">// the HTTP method (GET, ..etc)</span>
    <span class="n">request</span><span class="p">.</span><span class="n">scheme</span>                   <span class="c1">// http or https</span>
    <span class="n">request</span><span class="p">.</span><span class="n">secure</span>                   <span class="c1">// true if scheme is https</span>
    <span class="n">request</span><span class="p">.</span><span class="n">host</span>                     <span class="c1">// the host, e.g. &quot;example.com&quot;</span>
    <span class="n">request</span><span class="p">.</span><span class="n">ip</span>                       <span class="c1">// client IP address</span>
    <span class="n">request</span><span class="p">.</span><span class="n">port</span>                     <span class="c1">// the server port</span>
    <span class="n">request</span><span class="p">.</span><span class="n">path</span>                     <span class="c1">// the request path, e.g. /result.jsp</span>
    <span class="n">request</span><span class="p">.</span><span class="n">body</span>                     <span class="c1">// request body sent by the client</span>
    <span class="n">request</span><span class="p">.</span><span class="n">url</span>                      <span class="c1">// the url. e.g. &quot;http://example.com/foo&quot;</span>

    <span class="c1">// Headers</span>
    <span class="n">request</span><span class="p">.</span><span class="n">headers</span>                  <span class="c1">// the HTTP header list with first values only</span>
    <span class="n">request</span><span class="p">.</span><span class="n">headers</span><span class="p">[</span><span class="s">&quot;BAR&quot;</span><span class="p">]</span>           <span class="c1">// first value of BAR header</span>
    <span class="n">request</span><span class="p">.</span><span class="n">headersValues</span>            <span class="c1">// the HTTP header list with their full values list</span>
    <span class="n">request</span><span class="p">.</span><span class="n">headersValues</span><span class="p">[</span><span class="s">&quot;BAR&quot;</span><span class="p">]</span>     <span class="c1">// list of values of BAR header</span>

    <span class="c1">// Common headers shortcuts</span>
    <span class="n">request</span><span class="p">.</span><span class="n">contentType</span>              <span class="c1">// content type of request.body</span>
    <span class="n">request</span><span class="p">.</span><span class="n">acceptValues</span>             <span class="c1">// Client accepted content types</span>
    <span class="n">request</span><span class="p">.</span><span class="n">userAgent</span>                <span class="c1">// user agent (browser requests)</span>
    <span class="n">request</span><span class="p">.</span><span class="n">origin</span>                   <span class="c1">// origin (browser requests)</span>

    <span class="c1">// Parameters</span>
    <span class="n">request</span><span class="p">.</span><span class="n">pathParameters</span>           <span class="c1">// map with all path parameters</span>
    <span class="n">request</span><span class="p">.</span><span class="n">formParameters</span>           <span class="c1">// map with first values of all form fields</span>
    <span class="n">request</span><span class="p">.</span><span class="n">formParametersValues</span>     <span class="c1">// map with all form fields values</span>
    <span class="n">request</span><span class="p">.</span><span class="n">queryParameters</span>          <span class="c1">// map with first values of all query parameters</span>
    <span class="n">request</span><span class="p">.</span><span class="n">queryParametersValues</span>    <span class="c1">// map with all query parameters values</span>

    <span class="c1">// Body processing</span>
    <span class="n">request</span><span class="p">.</span><span class="n">contentLength</span>            <span class="c1">// length of request body</span>
    <span class="n">request</span><span class="p">.</span><span class="n">body</span><span class="p">(</span><span class="n">Type</span><span class="o">::</span><span class="k">class</span><span class="p">)</span>        <span class="c1">// Object passed in the body as a typed object</span>
    <span class="n">request</span><span class="p">.</span><span class="n">body</span><span class="p">&lt;</span><span class="n">Type</span><span class="p">&gt;()</span>             <span class="c1">// Syntactic sugar for the previous statement</span>
    <span class="n">request</span><span class="p">.</span><span class="n">bodyObjects</span><span class="p">(</span><span class="n">Type</span><span class="o">::</span><span class="k">class</span><span class="p">)</span> <span class="c1">// Object(s) passed in the body as a typed list</span>
    <span class="n">request</span><span class="p">.</span><span class="n">bodyObjects</span><span class="p">&lt;</span><span class="n">Type</span><span class="p">&gt;()</span>      <span class="c1">// Syntactic sugar for the previous statement</span>
    <span class="n">request</span><span class="p">.</span><span class="n">body</span><span class="p">(</span><span class="n">Map</span><span class="o">::</span><span class="k">class</span><span class="p">)</span>         <span class="c1">// Object passed in the body as a field map</span>
    <span class="n">request</span><span class="p">.</span><span class="n">body</span><span class="p">&lt;</span><span class="n">Map</span><span class="p">&lt;*,</span> <span class="p">*&gt;&gt;()</span>        <span class="c1">// Syntactic sugar for the previous statement</span>
    <span class="n">request</span><span class="p">.</span><span class="n">bodyObjects</span><span class="p">(</span><span class="n">Map</span><span class="o">::</span><span class="k">class</span><span class="p">)</span>  <span class="c1">// Object(s) passed in the body as a list of maps</span>
    <span class="n">request</span><span class="p">.</span><span class="n">bodyObjects</span><span class="p">&lt;</span><span class="n">Map</span><span class="p">&lt;*,</span> <span class="p">*&gt;&gt;()</span> <span class="c1">// Syntactic sugar for the previous statement</span>
<span class="p">}</span>
</code></pre></div>
</td></tr></table>

<h5 id="path-parameters">Path Parameters<a class="headerlink" href="#path-parameters" title="Permanent link">&para;</a></h5>
<p>Route patterns can include named parameters, accessible via the <code class="codehilite"><span class="err">pathParameters</span></code> map on the request
object:</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2
3
4</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><code><span class="k">get</span><span class="p">(</span><span class="s">&quot;/pathParam/{foo}&quot;</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">request</span><span class="p">.</span><span class="n">pathParameters</span><span class="p">[</span><span class="s">&quot;foo&quot;</span><span class="p">]</span> <span class="c1">// value of foo path parameter</span>
    <span class="n">request</span><span class="p">.</span><span class="n">pathParameters</span>        <span class="c1">// map with all parameters</span>
<span class="p">}</span>
</code></pre></div>
</td></tr></table>

<h5 id="query-parameters">Query Parameters<a class="headerlink" href="#query-parameters" title="Permanent link">&para;</a></h5>
<p>It is possible to access the whole query string or only an specific query parameter using the
<code class="codehilite"><span class="err">parameters</span></code> map on the <code class="codehilite"><span class="err">request</span></code> object:</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2
3
4
5
6
7</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><code><span class="k">get</span><span class="p">(</span><span class="s">&quot;/queryParam&quot;</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">request</span><span class="p">.</span><span class="n">queryString</span>
    <span class="n">request</span><span class="p">.</span><span class="n">queryParameters</span>                       <span class="c1">// the query param list</span>
    <span class="n">request</span><span class="p">.</span><span class="n">queryParameters</span><span class="p">[</span><span class="s">&quot;FOO&quot;</span><span class="p">]</span>                <span class="c1">// value of FOO query param</span>
    <span class="n">request</span><span class="p">.</span><span class="n">queryParametersValues</span>                 <span class="c1">// the query param list</span>
    <span class="n">request</span><span class="p">.</span><span class="n">queryParametersValues</span><span class="p">[</span><span class="s">&quot;FOO&quot;</span><span class="p">]</span>          <span class="c1">// all values of FOO query param</span>
<span class="p">}</span>
</code></pre></div>
</td></tr></table>

<h5 id="form-parameters">Form Parameters<a class="headerlink" href="#form-parameters" title="Permanent link">&para;</a></h5>
<p>HTML Form processing. Don't parse body!</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2
3
4
5
6</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><code><span class="k">get</span><span class="p">(</span><span class="s">&quot;/formParam&quot;</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">request</span><span class="p">.</span><span class="n">formParameters</span>                       <span class="c1">// the query param list</span>
    <span class="n">request</span><span class="p">.</span><span class="n">formParameters</span><span class="p">[</span><span class="s">&quot;FOO&quot;</span><span class="p">]</span>                <span class="c1">// value of FOO query param</span>
    <span class="n">request</span><span class="p">.</span><span class="n">formParametersValues</span>                 <span class="c1">// the query param list</span>
    <span class="n">request</span><span class="p">.</span><span class="n">formParametersValues</span><span class="p">[</span><span class="s">&quot;FOO&quot;</span><span class="p">]</span>          <span class="c1">// all values of FOO query param</span>
<span class="p">}</span>
</code></pre></div>
</td></tr></table>

<h5 id="file-uploads">File Uploads<a class="headerlink" href="#file-uploads" title="Permanent link">&para;</a></h5>
<p>Multipart Requests</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2
3
4</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><code><span class="n">post</span><span class="p">(</span><span class="s">&quot;/file&quot;</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">val</span> <span class="py">filePart</span> <span class="p">=</span> <span class="n">request</span><span class="p">.</span><span class="n">parts</span><span class="p">[</span><span class="s">&quot;file&quot;</span><span class="p">]</span> <span class="o">?:</span> <span class="n">error</span><span class="p">(</span><span class="s">&quot;File not available&quot;</span><span class="p">)</span>
    <span class="n">ok</span><span class="p">(</span><span class="n">filePart</span><span class="p">.</span><span class="n">inputStream</span><span class="p">.</span><span class="n">reader</span><span class="p">().</span><span class="n">readText</span><span class="p">())</span>
<span class="p">}</span>
</code></pre></div>
</td></tr></table>

<h5 id="response">Response<a class="headerlink" href="#response" title="Permanent link">&para;</a></h5>
<p>Response information is provided by the <code class="codehilite"><span class="err">response</span></code> field:</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span> 1
 2
 3
 4
 5
 6
 7
 8
 9
10</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><code><span class="k">get</span><span class="p">(</span><span class="s">&quot;/response&quot;</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">response</span><span class="p">.</span><span class="n">body</span>                             <span class="c1">// get response content</span>
    <span class="n">response</span><span class="p">.</span><span class="n">body</span> <span class="p">=</span> <span class="s">&quot;Hello&quot;</span>                   <span class="c1">// sets content to Hello</span>
    <span class="n">response</span><span class="p">.</span><span class="n">headers</span><span class="p">[</span><span class="s">&quot;FOO&quot;</span><span class="p">]</span> <span class="p">=</span> <span class="s">&quot;bar&quot;</span>           <span class="c1">// sets header FOO with single value bar</span>
    <span class="n">response</span><span class="p">.</span><span class="n">headersValues</span><span class="p">[</span><span class="s">&quot;FOO&quot;</span><span class="p">]</span> <span class="p">=</span> <span class="n">listOf</span><span class="p">(</span><span class="s">&quot;bar&quot;</span><span class="p">)</span> <span class="c1">// sets header FOO values with [ bar ]</span>
    <span class="n">response</span><span class="p">.</span><span class="n">status</span>                           <span class="c1">// get the response status</span>
    <span class="n">response</span><span class="p">.</span><span class="n">status</span> <span class="p">=</span> <span class="m">401</span>                     <span class="c1">// set status code to 401</span>
    <span class="n">response</span><span class="p">.</span><span class="n">contentType</span>                      <span class="c1">// get the content type</span>
    <span class="n">response</span><span class="p">.</span><span class="n">contentType</span> <span class="p">=</span> <span class="s">&quot;text/xml&quot;</span>         <span class="c1">// set content type to text/xml</span>
<span class="p">}</span>
</code></pre></div>
</td></tr></table>

<h5 id="redirects">Redirects<a class="headerlink" href="#redirects" title="Permanent link">&para;</a></h5>
<p>You can redirect requests (returning 30x codes) by using <code class="codehilite"><span class="err">Call</span></code> utility methods:</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2
3</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><code><span class="k">get</span><span class="p">(</span><span class="s">&quot;/redirect&quot;</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">redirect</span><span class="p">(</span><span class="s">&quot;/call&quot;</span><span class="p">)</span> <span class="c1">// browser redirect to /call</span>
<span class="p">}</span>
</code></pre></div>
</td></tr></table>

<h5 id="cookies">Cookies<a class="headerlink" href="#cookies" title="Permanent link">&para;</a></h5>
<p>The request and response cookie functions provide a convenient way for sharing information between
handlers, requests, or even servers.</p>
<p>You can read client sent cookies from the request's <code class="codehilite"><span class="err">cookies</span></code> read only map. To change cookies or
add new ones you have to use <code class="codehilite"><span class="err">response.addCookie()</span></code> and <code class="codehilite"><span class="err">response.removeCookie()</span></code> methods.</p>
<p>Check the following sample code for details:</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><code><span class="k">get</span><span class="p">(</span><span class="s">&quot;/cookie&quot;</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">request</span><span class="p">.</span><span class="n">cookies</span>                       <span class="c1">// get map of all request cookies</span>
    <span class="n">request</span><span class="p">.</span><span class="n">cookies</span><span class="p">[</span><span class="s">&quot;foo&quot;</span><span class="p">]</span>                <span class="c1">// access request cookie by name</span>

    <span class="k">val</span> <span class="py">cookie</span> <span class="p">=</span> <span class="n">HttpCookie</span><span class="p">(</span><span class="s">&quot;new_foo&quot;</span><span class="p">,</span> <span class="s">&quot;bar&quot;</span><span class="p">)</span>
    <span class="n">response</span><span class="p">.</span><span class="n">addCookie</span><span class="p">(</span><span class="n">cookie</span><span class="p">)</span>            <span class="c1">// set cookie with a value</span>

    <span class="n">cookie</span><span class="p">.</span><span class="n">maxAge</span> <span class="p">=</span> <span class="m">3600</span>
    <span class="n">response</span><span class="p">.</span><span class="n">addCookie</span><span class="p">(</span><span class="n">cookie</span><span class="p">)</span>            <span class="c1">// set cookie with a max-age</span>

    <span class="n">cookie</span><span class="p">.</span><span class="n">secure</span> <span class="p">=</span> <span class="k">true</span>
    <span class="n">response</span><span class="p">.</span><span class="n">addCookie</span><span class="p">(</span><span class="n">cookie</span><span class="p">)</span>            <span class="c1">// secure cookie</span>

    <span class="n">response</span><span class="p">.</span><span class="n">removeCookie</span><span class="p">(</span><span class="s">&quot;foo&quot;</span><span class="p">)</span>          <span class="c1">// remove cookie</span>
<span class="p">}</span>
</code></pre></div>
</td></tr></table>

<h5 id="sessions">Sessions<a class="headerlink" href="#sessions" title="Permanent link">&para;</a></h5>
<p>Every request has access to the session created on the server side, the <code class="codehilite"><span class="err">session</span></code> object provides
the following methods:</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2
3
4
5
6
7
8
9</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><code><span class="k">get</span><span class="p">(</span><span class="s">&quot;/session&quot;</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">session</span>                         <span class="c1">// create and return session</span>
    <span class="n">session</span><span class="p">.</span><span class="n">attributes</span><span class="p">[</span><span class="s">&quot;user&quot;</span><span class="p">]</span>      <span class="c1">// Get session attribute &#39;user&#39;</span>
    <span class="n">session</span><span class="p">.</span><span class="k">set</span><span class="p">(</span><span class="s">&quot;user&quot;</span><span class="p">,</span> <span class="s">&quot;foo&quot;</span><span class="p">)</span>      <span class="c1">// Set session attribute &#39;user&#39;</span>
    <span class="n">session</span><span class="p">.</span><span class="n">removeAttribute</span><span class="p">(</span><span class="s">&quot;user&quot;</span><span class="p">)</span> <span class="c1">// Remove session attribute &#39;user&#39;</span>
    <span class="n">session</span><span class="p">.</span><span class="n">attributes</span>              <span class="c1">// Get all session attributes</span>
    <span class="n">session</span><span class="p">.</span><span class="n">id</span>                      <span class="c1">// Get session id</span>
    <span class="n">session</span><span class="p">.</span><span class="n">isNew</span><span class="p">()</span>                 <span class="c1">// Check if session is new</span>
<span class="p">}</span>
</code></pre></div>
</td></tr></table>

<h5 id="halting">Halting<a class="headerlink" href="#halting" title="Permanent link">&para;</a></h5>
<p>To immediately stop a request within a filter or route use <code class="codehilite"><span class="err">halt()</span></code>. <code class="codehilite"><span class="err">halt()</span></code> is not intended to be
used inside exception-mappers. Check the following snippet for an example:</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span> 1
 2
 3
 4
 5
 6
 7
 8
 9
10</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><code><span class="k">get</span><span class="p">(</span><span class="s">&quot;/halt&quot;</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">halt</span><span class="p">()</span>                <span class="c1">// halt with status 500 and stop route processing</span>

    <span class="cm">/*</span>
<span class="cm">     * These are just examples the following code will never be reached</span>
<span class="cm">     */</span>
    <span class="n">halt</span><span class="p">(</span><span class="m">401</span><span class="p">)</span>             <span class="c1">// halt with status</span>
    <span class="n">halt</span><span class="p">(</span><span class="s">&quot;Body Message&quot;</span><span class="p">)</span>  <span class="c1">// halt with message (status 500)</span>
    <span class="n">halt</span><span class="p">(</span><span class="m">401</span><span class="p">,</span> <span class="s">&quot;Go away!&quot;</span><span class="p">)</span> <span class="c1">// halt with status and message</span>
<span class="p">}</span>
</code></pre></div>
</td></tr></table>

<h4 id="filters">Filters<a class="headerlink" href="#filters" title="Permanent link">&para;</a></h4>
<p>You might know filters as interceptors, or middleware from other libraries. Filters are blocks of
code executed before or after one or more routes. They can read the request and read/modify the
response.</p>
<p>All filters that match a route are executed in the order they are declared.</p>
<p>Filters optionally take a pattern, causing them to be executed only if the request path matches
that pattern.</p>
<p>Before and after filters are always executed (if the route is matched). But any of them may stop
the execution chain if halted.</p>
<p>If <code class="codehilite"><span class="err">halt()</span></code> is called in one filter, filter processing is stopped for that kind of filter (<em>before</em>
or <em>after</em>). In the case of before filters, this also prevent the route from being executed (but
after filters are executed anyway).</p>
<p>The following code details filters usage:</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><code><span class="n">before</span> <span class="p">{</span> <span class="n">response</span><span class="p">.</span><span class="n">headersValues</span><span class="p">[</span><span class="s">&quot;b_all&quot;</span><span class="p">]</span> <span class="p">=</span> <span class="n">listOf</span><span class="p">(</span><span class="s">&quot;true&quot;</span><span class="p">)</span> <span class="p">}</span>

<span class="n">before</span><span class="p">(</span><span class="s">&quot;/filters/*&quot;</span><span class="p">)</span> <span class="p">{</span> <span class="n">response</span><span class="p">.</span><span class="n">headersValues</span><span class="p">[</span><span class="s">&quot;b_filters&quot;</span><span class="p">]</span> <span class="p">=</span> <span class="n">listOf</span><span class="p">(</span><span class="s">&quot;true&quot;</span><span class="p">)</span> <span class="p">}</span>
<span class="k">get</span><span class="p">(</span><span class="s">&quot;/filters/route&quot;</span><span class="p">)</span> <span class="p">{</span> <span class="n">ok</span><span class="p">(</span><span class="s">&quot;filters route&quot;</span><span class="p">)</span> <span class="p">}</span>
<span class="n">after</span><span class="p">(</span><span class="s">&quot;/filters/*&quot;</span><span class="p">)</span> <span class="p">{</span> <span class="n">response</span><span class="p">.</span><span class="n">headersValues</span><span class="p">[</span><span class="s">&quot;a_filters&quot;</span><span class="p">]</span> <span class="p">=</span> <span class="n">listOf</span><span class="p">(</span><span class="s">&quot;true&quot;</span><span class="p">)</span> <span class="p">}</span>

<span class="k">get</span><span class="p">(</span><span class="s">&quot;/filters&quot;</span><span class="p">)</span> <span class="p">{</span> <span class="n">ok</span><span class="p">(</span><span class="s">&quot;filters&quot;</span><span class="p">)</span> <span class="p">}</span>

<span class="n">path</span><span class="p">(</span><span class="s">&quot;/nested&quot;</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">before</span> <span class="p">{</span> <span class="n">response</span><span class="p">.</span><span class="n">headersValues</span><span class="p">[</span><span class="s">&quot;b_nested&quot;</span><span class="p">]</span> <span class="p">=</span> <span class="n">listOf</span><span class="p">(</span><span class="s">&quot;true&quot;</span><span class="p">)</span> <span class="p">}</span>
    <span class="n">before</span><span class="p">(</span><span class="s">&quot;/&quot;</span><span class="p">)</span> <span class="p">{</span> <span class="n">response</span><span class="p">.</span><span class="n">headersValues</span><span class="p">[</span><span class="s">&quot;b_nested_2&quot;</span><span class="p">]</span> <span class="p">=</span> <span class="n">listOf</span><span class="p">(</span><span class="s">&quot;true&quot;</span><span class="p">)</span> <span class="p">}</span>
    <span class="k">get</span><span class="p">(</span><span class="s">&quot;/filters&quot;</span><span class="p">)</span> <span class="p">{</span> <span class="n">ok</span><span class="p">(</span><span class="s">&quot;nested filters&quot;</span><span class="p">)</span> <span class="p">}</span>
    <span class="k">get</span><span class="p">(</span><span class="s">&quot;/halted&quot;</span><span class="p">)</span> <span class="p">{</span> <span class="n">halt</span><span class="p">(</span><span class="m">499</span><span class="p">,</span> <span class="s">&quot;halted&quot;</span><span class="p">)</span> <span class="p">}</span>
    <span class="k">get</span> <span class="p">{</span> <span class="n">ok</span><span class="p">(</span><span class="s">&quot;nested also&quot;</span><span class="p">)</span> <span class="p">}</span>
    <span class="n">after</span> <span class="p">{</span> <span class="n">response</span><span class="p">.</span><span class="n">headersValues</span><span class="p">[</span><span class="s">&quot;a_nested&quot;</span><span class="p">]</span> <span class="p">=</span> <span class="n">listOf</span><span class="p">(</span><span class="s">&quot;true&quot;</span><span class="p">)</span> <span class="p">}</span>
<span class="p">}</span>

<span class="n">after</span> <span class="p">{</span> <span class="n">response</span><span class="p">.</span><span class="n">headersValues</span><span class="p">[</span><span class="s">&quot;a_all&quot;</span><span class="p">]</span> <span class="p">=</span> <span class="n">listOf</span><span class="p">(</span><span class="s">&quot;true&quot;</span><span class="p">)</span> <span class="p">}</span>
</code></pre></div>
</td></tr></table>

<h4 id="error-handling">Error Handling<a class="headerlink" href="#error-handling" title="Permanent link">&para;</a></h4>
<p>You can provide handlers for runtime errors. Errors are unhandled thrown exceptions in the
callbacks, or handlers halted with an error code.</p>
<p>Error handlers for a given code or exception are unique, and the first one defined is the one that
will be used.</p>
<h5 id="http-errors-handlers">HTTP Errors Handlers<a class="headerlink" href="#http-errors-handlers" title="Permanent link">&para;</a></h5>
<p>Allows to handle routes halted with a given code. These handlers are only applied if the route is
halted, if the error code is returned with <code class="codehilite"><span class="err">send</span></code> it won't be handled as an error. Example:</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2
3
4
5</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><code><span class="c1">// Register handler for routes halted with 512 code</span>
<span class="n">error</span><span class="p">(</span><span class="m">512</span><span class="p">)</span> <span class="p">{</span> <span class="n">send</span><span class="p">(</span><span class="m">500</span><span class="p">,</span> <span class="s">&quot;Ouch&quot;</span><span class="p">)}</span>

<span class="c1">// If status code (512) is returned with `send` error won&#39;t be triggered</span>
<span class="k">get</span><span class="p">(</span><span class="s">&quot;/errors&quot;</span><span class="p">)</span> <span class="p">{</span> <span class="n">halt</span><span class="p">(</span><span class="m">512</span><span class="p">)</span> <span class="p">}</span>
</code></pre></div>
</td></tr></table>

<h5 id="exception-mapping">Exception Mapping<a class="headerlink" href="#exception-mapping" title="Permanent link">&para;</a></h5>
<p>You can handle exceptions of a given type for all routes and filters. The handler allows you to
refer to the thrown exception. Look at the following code for a detailed example:</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2
3
4
5</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><code><span class="c1">// Register handler for routes which callbacks throw exceptions</span>
<span class="n">error</span><span class="p">(</span><span class="n">CodedException</span><span class="o">::</span><span class="k">class</span><span class="p">)</span> <span class="p">{</span> <span class="n">send</span><span class="p">(</span><span class="m">599</span><span class="p">,</span> <span class="n">it</span><span class="p">.</span><span class="n">message</span> <span class="o">?:</span> <span class="s">&quot;empty&quot;</span><span class="p">)</span> <span class="p">}</span>
<span class="n">error</span><span class="p">(</span><span class="n">IllegalStateException</span><span class="o">::</span><span class="k">class</span><span class="p">)</span> <span class="p">{</span> <span class="n">send</span><span class="p">(</span><span class="m">505</span><span class="p">,</span> <span class="n">it</span><span class="p">.</span><span class="n">message</span> <span class="o">?:</span> <span class="s">&quot;empty&quot;</span><span class="p">)</span> <span class="p">}</span>
<span class="k">get</span><span class="p">(</span><span class="s">&quot;/exceptions&quot;</span><span class="p">)</span> <span class="p">{</span> <span class="n">error</span><span class="p">(</span><span class="s">&quot;Message&quot;</span><span class="p">)</span> <span class="p">}</span>
<span class="k">get</span><span class="p">(</span><span class="s">&quot;/codedExceptions&quot;</span><span class="p">)</span> <span class="p">{</span> <span class="n">halt</span><span class="p">(</span><span class="m">509</span><span class="p">,</span> <span class="s">&quot;code&quot;</span><span class="p">)</span> <span class="p">}</span>
</code></pre></div>
</td></tr></table>

<h4 id="static-files">Static Files<a class="headerlink" href="#static-files" title="Permanent link">&para;</a></h4>
<p>You can use a folder in the classpath for serving static files with the <code class="codehilite"><span class="err">get()</span></code> methods. Note that
the public directory name is not included in the URL.</p>
<p>Asset mapping is handled like any other route, so if an asset mapping is matched, no other route
will be checked (assets or other routes). And also, if a previous route is matched, the asset
mapping will never be checked.</p>
<p>Being <code class="codehilite"><span class="err">get(resource)</span></code> a shortcut of <code class="codehilite"><span class="err">get(&quot;/*&quot;, resource)</span></code> it should be placed as the last route.
Check the next example for details:</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2
3
4
5
6
7
8</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><code><span class="k">get</span><span class="p">(</span><span class="s">&quot;/web/file.txt&quot;</span><span class="p">)</span> <span class="p">{</span> <span class="n">ok</span><span class="p">(</span><span class="s">&quot;It matches this route and won&#39;t search for the file&quot;</span><span class="p">)</span> <span class="p">}</span>

<span class="c1">// Expose resources on the &#39;/public&#39; resource folder over the &#39;/web&#39; HTTP path</span>
<span class="k">get</span><span class="p">(</span><span class="s">&quot;/web/*&quot;</span><span class="p">,</span> <span class="n">Resource</span><span class="p">(</span><span class="s">&quot;public&quot;</span><span class="p">))</span>

<span class="c1">// Maps resources on &#39;assets&#39; on the server root (assets/f.css -&gt; /f.css)</span>
<span class="c1">// &#39;/public/css/style.css&#39; resource would be: &#39;http://{host}:{port}/css/style.css&#39;</span>
<span class="k">get</span><span class="p">(</span><span class="n">Resource</span><span class="p">(</span><span class="s">&quot;assets&quot;</span><span class="p">))</span>
</code></pre></div>
</td></tr></table>

<h5 id="mime-types">MIME types<a class="headerlink" href="#mime-types" title="Permanent link">&para;</a></h5>
<p>The MIME types of static files are computed from the file extension using the
<a href="/hexagon_core/com.hexagonkt.serialization/-serialization-manager/content-type-of/">SerializationManager.contentTypeOf</a> method.</p>
<h4 id="cors">CORS<a class="headerlink" href="#cors" title="Permanent link">&para;</a></h4>
<p>CORS behaviour can be different depending on the path. You can attach different <a href="/port_http_server/com.hexagonkt.http.server/-cors-settings/">CorsSettings</a> to
different routers. Check <a href="/port_http_server/com.hexagonkt.http.server/-cors-settings/">CorsSettings</a> class for more details.</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><code><span class="k">val</span> <span class="py">server</span><span class="p">:</span> <span class="n">Server</span> <span class="p">=</span> <span class="n">Server</span><span class="p">(</span><span class="n">adapter</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">corsPath</span><span class="p">(</span><span class="s">&quot;/default&quot;</span><span class="p">,</span> <span class="n">CorsSettings</span><span class="p">())</span>
    <span class="n">corsPath</span><span class="p">(</span><span class="s">&quot;/example/org&quot;</span><span class="p">,</span> <span class="n">CorsSettings</span><span class="p">(</span><span class="s">&quot;example.org&quot;</span><span class="p">))</span>
    <span class="n">corsPath</span><span class="p">(</span><span class="s">&quot;/no/credentials&quot;</span><span class="p">,</span> <span class="n">CorsSettings</span><span class="p">(</span><span class="n">supportCredentials</span> <span class="p">=</span> <span class="k">false</span><span class="p">))</span>
    <span class="n">corsPath</span><span class="p">(</span><span class="s">&quot;/only/post&quot;</span><span class="p">,</span> <span class="n">CorsSettings</span><span class="p">(</span><span class="n">allowedMethods</span> <span class="p">=</span> <span class="n">setOf</span><span class="p">(</span><span class="n">POST</span><span class="p">)))</span>
    <span class="n">corsPath</span><span class="p">(</span><span class="s">&quot;/cache&quot;</span><span class="p">,</span> <span class="n">CorsSettings</span><span class="p">(</span><span class="n">preFlightMaxAge</span> <span class="p">=</span> <span class="m">10</span><span class="p">))</span>
    <span class="n">corsPath</span><span class="p">(</span><span class="s">&quot;/exposed/headers&quot;</span><span class="p">,</span> <span class="n">CorsSettings</span><span class="p">(</span><span class="n">exposedHeaders</span> <span class="p">=</span> <span class="n">setOf</span><span class="p">(</span><span class="s">&quot;head&quot;</span><span class="p">)))</span>
    <span class="n">corsPath</span><span class="p">(</span><span class="s">&quot;/allowed/headers&quot;</span><span class="p">,</span> <span class="n">CorsSettings</span><span class="p">(</span><span class="n">allowedHeaders</span> <span class="p">=</span> <span class="n">setOf</span><span class="p">(</span><span class="s">&quot;head&quot;</span><span class="p">)))</span>
<span class="p">}</span>

<span class="k">private</span> <span class="k">fun</span> <span class="nc">Router</span><span class="p">.</span><span class="nf">corsPath</span><span class="p">(</span><span class="n">path</span><span class="p">:</span> <span class="n">String</span><span class="p">,</span> <span class="n">settings</span><span class="p">:</span> <span class="n">CorsSettings</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">path</span><span class="p">(</span><span class="n">path</span><span class="p">)</span> <span class="p">{</span>
        <span class="c1">// CORS settings can change for different routes</span>
        <span class="n">cors</span><span class="p">(</span><span class="n">settings</span><span class="p">)</span>

        <span class="k">get</span><span class="p">(</span><span class="s">&quot;/path&quot;</span><span class="p">)</span> <span class="p">{</span> <span class="n">ok</span><span class="p">(</span><span class="n">request</span><span class="p">.</span><span class="n">method</span><span class="p">)</span> <span class="p">}</span>
        <span class="n">post</span><span class="p">(</span><span class="s">&quot;/path&quot;</span><span class="p">)</span> <span class="p">{</span> <span class="n">ok</span><span class="p">(</span><span class="n">request</span><span class="p">.</span><span class="n">method</span><span class="p">)</span> <span class="p">}</span>
        <span class="n">put</span><span class="p">(</span><span class="s">&quot;/path&quot;</span><span class="p">)</span> <span class="p">{</span> <span class="n">ok</span><span class="p">(</span><span class="n">request</span><span class="p">.</span><span class="n">method</span><span class="p">)</span> <span class="p">}</span>
        <span class="n">delete</span><span class="p">(</span><span class="s">&quot;/path&quot;</span><span class="p">)</span> <span class="p">{</span> <span class="n">ok</span><span class="p">(</span><span class="n">request</span><span class="p">.</span><span class="n">method</span><span class="p">)</span> <span class="p">}</span>
        <span class="k">get</span> <span class="p">{</span> <span class="n">ok</span><span class="p">(</span><span class="n">request</span><span class="p">.</span><span class="n">method</span><span class="p">)</span> <span class="p">}</span>
        <span class="n">post</span> <span class="p">{</span> <span class="n">ok</span><span class="p">(</span><span class="n">request</span><span class="p">.</span><span class="n">method</span><span class="p">)</span> <span class="p">}</span>
        <span class="n">put</span> <span class="p">{</span> <span class="n">ok</span><span class="p">(</span><span class="n">request</span><span class="p">.</span><span class="n">method</span><span class="p">)</span> <span class="p">}</span>
        <span class="n">delete</span> <span class="p">{</span> <span class="n">ok</span><span class="p">(</span><span class="n">request</span><span class="p">.</span><span class="n">method</span><span class="p">)</span> <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
</td></tr></table>

<h4 id="https">HTTPS<a class="headerlink" href="#https" title="Permanent link">&para;</a></h4>
<p>It is possible to start a secure server enabling HTTPS. For this, you have to provide a server
certificate and its key in the server's <a href="/hexagon_core/com.hexagonkt.http/-ssl-settings/">SslSettings</a>. Once you use a server certificate, it is also
possible to serve content using <a href="https://en.wikipedia.org/wiki/HTTP/2">HTTP/2</a>, for this to work, <a href="https://en.wikipedia.org/wiki/Application-Layer_Protocol_Negotiation">ALPN</a> is required (however, this is
already handled if you use Java 11).</p>
<p>The certificate common name should match the host that will serve the content in order to be
accepted by an HTTP client without a security error. There is a <a href="https://gradle.org">Gradle</a> helper to
<a href="/gradle/#certificates">create sample certificates</a> for development purposes.</p>
<p>HTTP clients can also be configured to use a certificate. This is required to implement a double
ended authorization (<a href="https://en.wikipedia.org/wiki/Mutual_authentication">mutual TLS</a>). This is also done by passing a <a href="/hexagon_core/com.hexagonkt.http/-ssl-settings/">SslSettings</a> object the the
HTTP client.</p>
<p>If you want to implement mutual trust, you must enforce client certificate in the server
configuration (check <a href="/hexagon_core/com.hexagonkt.http/-ssl-settings/client-auth">SslSettings.clientAuth</a>). If this is done, you can access the certificate the
client used to connect (assuming it is valid, if not the connection will end with an error) with the
<a href="/port_http_server/com.hexagonkt.http.server/-request/certificate-chain">Request.certificateChain</a> property.</p>
<p>Below you can find a simple example to set up an HTTPS server and client with mutual TLS:</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><code><span class="c1">// Key store files</span>
<span class="k">val</span> <span class="py">identity</span> <span class="p">=</span> <span class="s">&quot;hexagonkt.p12&quot;</span>
<span class="k">val</span> <span class="py">trust</span> <span class="p">=</span> <span class="s">&quot;trust.p12&quot;</span>

<span class="c1">// Default passwords are file name reversed</span>
<span class="k">val</span> <span class="py">keyStorePassword</span> <span class="p">=</span> <span class="n">identity</span><span class="p">.</span><span class="n">reversed</span><span class="p">()</span>
<span class="k">val</span> <span class="py">trustStorePassword</span> <span class="p">=</span> <span class="n">trust</span><span class="p">.</span><span class="n">reversed</span><span class="p">()</span>

<span class="c1">// Key stores can be set as URIs to classpath resources (the triple slash is needed)</span>
<span class="k">val</span> <span class="py">keyStore</span> <span class="p">=</span> <span class="n">URI</span><span class="p">(</span><span class="s">&quot;resource:///ssl/$identity&quot;</span><span class="p">)</span>
<span class="k">val</span> <span class="py">trustStore</span> <span class="p">=</span> <span class="n">URI</span><span class="p">(</span><span class="s">&quot;resource:///ssl/$trust&quot;</span><span class="p">)</span>

<span class="k">val</span> <span class="py">sslSettings</span> <span class="p">=</span> <span class="n">SslSettings</span><span class="p">(</span>
    <span class="n">keyStore</span> <span class="p">=</span> <span class="n">keyStore</span><span class="p">,</span>
    <span class="n">keyStorePassword</span> <span class="p">=</span> <span class="n">keyStorePassword</span><span class="p">,</span>
    <span class="n">trustStore</span> <span class="p">=</span> <span class="n">trustStore</span><span class="p">,</span>
    <span class="n">trustStorePassword</span> <span class="p">=</span> <span class="n">trustStorePassword</span><span class="p">,</span>
    <span class="n">clientAuth</span> <span class="p">=</span> <span class="k">true</span> <span class="c1">// Requires a valid certificate from the client (mutual TLS)</span>
<span class="p">)</span>

<span class="k">val</span> <span class="py">serverSettings</span> <span class="p">=</span> <span class="n">ServerSettings</span><span class="p">(</span>
    <span class="n">bindPort</span> <span class="p">=</span> <span class="m">0</span><span class="p">,</span>
    <span class="n">protocol</span> <span class="p">=</span> <span class="n">HTTPS</span><span class="p">,</span> <span class="c1">// You can also use HTTP2</span>
    <span class="n">sslSettings</span> <span class="p">=</span> <span class="n">sslSettings</span>
<span class="p">)</span>

<span class="k">val</span> <span class="py">server</span> <span class="p">=</span> <span class="n">serve</span><span class="p">(</span><span class="n">serverSettings</span><span class="p">,</span> <span class="n">serverAdapter</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">get</span><span class="p">(</span><span class="s">&quot;/hello&quot;</span><span class="p">)</span> <span class="p">{</span>
        <span class="c1">// We can access the certificate used by the client from the request</span>
        <span class="k">val</span> <span class="py">subjectDn</span> <span class="p">=</span> <span class="n">request</span><span class="p">.</span><span class="n">certificate</span><span class="o">?.</span><span class="n">subjectDN</span><span class="o">?.</span><span class="n">name</span>
        <span class="n">response</span><span class="p">.</span><span class="n">headers</span><span class="p">[</span><span class="s">&quot;cert&quot;</span><span class="p">]</span> <span class="p">=</span> <span class="n">subjectDn</span>
        <span class="n">ok</span><span class="p">(</span><span class="s">&quot;Hello World!&quot;</span><span class="p">)</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="c1">// We&#39;ll use the same certificate for the client (in a real scenario it would be different)</span>
<span class="k">val</span> <span class="py">clientSettings</span> <span class="p">=</span> <span class="n">ClientSettings</span><span class="p">(</span><span class="n">sslSettings</span> <span class="p">=</span> <span class="n">sslSettings</span><span class="p">)</span>

<span class="c1">// Create a HTTP client and make a HTTPS request</span>
<span class="k">val</span> <span class="py">client</span> <span class="p">=</span> <span class="n">Client</span><span class="p">(</span><span class="n">AhcAdapter</span><span class="p">(),</span> <span class="s">&quot;https://localhost:${server.runtimePort}&quot;</span><span class="p">,</span> <span class="n">clientSettings</span><span class="p">)</span>
<span class="n">client</span><span class="p">.</span><span class="k">get</span><span class="p">(</span><span class="s">&quot;/hello&quot;</span><span class="p">).</span><span class="n">apply</span> <span class="p">{</span>
    <span class="n">logger</span><span class="p">.</span><span class="n">debug</span> <span class="p">{</span> <span class="n">body</span> <span class="p">}</span>
    <span class="c1">// Assure the certificate received (and returned) by the server is correct</span>
    <span class="n">assert</span><span class="p">(</span><span class="n">headers</span><span class="p">.</span><span class="n">require</span><span class="p">(</span><span class="s">&quot;cert&quot;</span><span class="p">).</span><span class="n">first</span><span class="p">().</span><span class="n">startsWith</span><span class="p">(</span><span class="s">&quot;CN=hexagonkt.com&quot;</span><span class="p">))</span>
    <span class="n">assert</span><span class="p">(</span><span class="n">body</span> <span class="p">==</span> <span class="s">&quot;Hello World!&quot;</span><span class="p">)</span>
<span class="p">}</span>
</code></pre></div>
</td></tr></table>

<h4 id="testing">Testing<a class="headerlink" href="#testing" title="Permanent link">&para;</a></h4>
<h5 id="integration-tests">Integration tests<a class="headerlink" href="#integration-tests" title="Permanent link">&para;</a></h5>
<p>To test HTTP servers from outside using a real Adapter, you can create a server setting <code class="codehilite"><span class="err">0</span></code> as port.
This will pick a random free port that you can check later:</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><code><span class="k">val</span> <span class="py">router</span> <span class="p">=</span> <span class="n">Router</span> <span class="p">{</span>
    <span class="k">get</span><span class="p">(</span><span class="s">&quot;/hello&quot;</span><span class="p">)</span> <span class="p">{</span> <span class="n">ok</span><span class="p">(</span><span class="s">&quot;Hi!&quot;</span><span class="p">)</span> <span class="p">}</span>
<span class="p">}</span>

<span class="k">val</span> <span class="py">serverSettings</span> <span class="p">=</span> <span class="n">ServerSettings</span><span class="p">(</span><span class="s">&quot;name&quot;</span><span class="p">,</span> <span class="n">InetAddress</span><span class="p">.</span><span class="n">getLoopbackAddress</span><span class="p">(),</span> <span class="m">0</span><span class="p">)</span>
<span class="k">val</span> <span class="py">server</span> <span class="p">=</span> <span class="n">Server</span><span class="p">(</span><span class="n">adapter</span><span class="p">,</span> <span class="n">router</span><span class="p">,</span> <span class="n">serverSettings</span><span class="p">)</span>

<span class="n">server</span><span class="p">.</span><span class="n">start</span><span class="p">()</span>
<span class="k">val</span> <span class="py">client</span> <span class="p">=</span> <span class="n">Client</span><span class="p">(</span><span class="n">AhcAdapter</span><span class="p">(),</span> <span class="s">&quot;http://localhost:${server.runtimePort}&quot;</span><span class="p">)</span>
<span class="n">assert</span><span class="p">(</span><span class="n">client</span><span class="p">.</span><span class="k">get</span><span class="p">(</span><span class="s">&quot;/hello&quot;</span><span class="p">).</span><span class="n">body</span> <span class="p">==</span> <span class="s">&quot;Hi!&quot;</span><span class="p">)</span>
<span class="n">server</span><span class="p">.</span><span class="n">stop</span><span class="p">()</span>
</code></pre></div>
</td></tr></table>

<p>To do this kind of tests without creating a custom server (using the real production code).
Check the <a href="https://github.com/hexagonkt/gradle_starter/blob/master/src/test/kotlin/GradleStarterTest.kt">tests of the starter projects</a>.</p>
<h5 id="mocking-calls">Mocking calls<a class="headerlink" href="#mocking-calls" title="Permanent link">&para;</a></h5>
<p>To unit test callbacks you can create test calls with hardcoded requests, responses and sessions.</p>
<p>To use it in your project you'll have to include a dependency (with test scope):</p>
<div class="superfences-tabs">
<input name="__tabs_1" type="radio" id="__tab_1_0" checked="checked" />
<label for="__tab_1_0">build.gradle</label>
<div class="superfences-content"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><code><span class="n">testImplementation</span><span class="o">(</span><span class="s2">&quot;com.hexagonkt:port_http_server:$hexagonVersion:test&quot;</span><span class="o">)</span>
</code></pre></div>
</td></tr></table></div>
<input name="__tabs_1" type="radio" id="__tab_1_1" />
<label for="__tab_1_1">pom.xml</label>
<div class="superfences-content"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2
3
4
5
6</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><code><span class="nt">&lt;dependency&gt;</span>
  <span class="nt">&lt;groupId&gt;</span>com.hexagonkt<span class="nt">&lt;/groupId&gt;</span>
  <span class="nt">&lt;artifactId&gt;</span>port_http_server<span class="nt">&lt;/artifactId&gt;</span>
  <span class="nt">&lt;version&gt;</span>$hexagonVersion<span class="nt">&lt;/version&gt;</span>
  <span class="nt">&lt;scope&gt;</span>test<span class="nt">&lt;/scope&gt;</span>
<span class="nt">&lt;/dependency&gt;</span>
</code></pre></div>
</td></tr></table></div>
</div>
<p>Check <a href="/port_http_server/com.hexagonkt.http.server.test/test-call/">testCall</a>, <a href="/port_http_server/com.hexagonkt.http.server.test/-test-request/">TestRequest</a>, <a href="#">TestResponse</a> and <a href="#">TestSession</a> for more details.</p>
<p>For a quick sample, check the snipped below:</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><code><span class="k">private</span> <span class="k">fun</span> <span class="nc">Call</span><span class="p">.</span><span class="nf">testedCallback</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">request</span><span class="p">.</span><span class="n">body</span> <span class="p">==</span> <span class="s">&quot;weird&quot;</span><span class="p">)</span>
        <span class="n">send</span><span class="p">(</span><span class="m">999</span><span class="p">,</span> <span class="s">&quot;Weird error&quot;</span><span class="p">)</span>
<span class="p">}</span>

<span class="n">@Test</span> <span class="k">fun</span> <span class="nf">`Test call behaves as expected`</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">val</span> <span class="py">testCall</span> <span class="p">=</span> <span class="n">testCall</span><span class="p">(</span><span class="n">TestRequest</span><span class="p">(</span><span class="n">body</span> <span class="p">=</span> <span class="s">&quot;weird&quot;</span><span class="p">))</span>

    <span class="n">testCall</span><span class="p">.</span><span class="n">testedCallback</span><span class="p">()</span>

    <span class="n">assert</span><span class="p">(</span><span class="n">testCall</span><span class="p">.</span><span class="n">response</span><span class="p">.</span><span class="n">status</span> <span class="p">==</span> <span class="m">999</span><span class="p">)</span>
    <span class="n">assert</span><span class="p">(</span><span class="n">testCall</span><span class="p">.</span><span class="n">response</span><span class="p">.</span><span class="n">body</span> <span class="p">==</span> <span class="s">&quot;Weird error&quot;</span><span class="p">)</span>
<span class="p">}</span>
</code></pre></div>
</td></tr></table>

<h4 id="packages">Packages<a class="headerlink" href="#packages" title="Permanent link">&para;</a></h4>
<table>
<thead>
<tr>
<th>Name</th>
<th>Summary</th>
</tr>
</thead>
<tbody>
<tr>
<td><a href="com.hexagonkt.http.server/">com.hexagonkt.http.server</a></td>
<td>This package defines the classes used in the HTTP DSL.</td>
</tr>
</tbody>
</table>
<h4 id="index">Index<a class="headerlink" href="#index" title="Permanent link">&para;</a></h4>
<p><a href="alltypes/">All Types</a></p>
  
    
  

              
  


  <h2 id="__comments">Comments</h2>
  <div id="disqus_thread"></div>
  <script>
    var disqus_config = function () {
      this.page.url = "https://hexagonkt.com/port_http_server/";
      this.page.identifier =
        "/port_http_server/";
    };
    (function() {
      var d = document, s = d.createElement("script");
      s.src = "//hexagonkt-com.disqus.com/embed.js";
      s.setAttribute("data-timestamp", +new Date());
      (d.head || d.body).appendChild(s);
    })();
  </script>


            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid">
        
          <a
            href="../hexagon_web/"
            title="Web"
            class="md-flex md-footer-nav__link md-footer-nav__link--prev"
            rel="prev">

            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-back md-footer-nav__button"></i>
            </div>
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Previous
                </span>
                Web
              </span>
            </div>
          </a>
        
        
          <a
            href="../port_http_client/"
            title="HTTP Client"
            class="md-flex md-footer-nav__link md-footer-nav__link--next"
            rel="next">

            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Next
                </span>
                HTTP Client
              </span>
            </div>
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-forward md-footer-nav__button"></i>
            </div>
          </a>
        
      </nav>
    </div>
  

  <!-- Sponsors -->
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        <p>This project is supported by:</p>
        <p>
          <a
            href="https://www.digitalocean.com/?utm_medium=opensource&utm_source=Hexagon-Toolkit"
            style="vertical-align: middle">
            <img
              height="128px"
              src=
                "https://opensource.nyc3.cdn.digitaloceanspaces.com/attribution/assets/SVG/DO_Logo_vertical_white.svg">
          </a>
          <a href="https://www.jetbrains.com/?from=Hexagon-Toolkit" style="vertical-align: middle">
            <img
              height="96px"
              src="/img/sponsors/jetbrains-variant-4-bw.svg">
          </a>
        </p>
      </div>
    </div>
  </div>

  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
          <div class="md-footer-copyright__highlight">
            Made with <i class="fa fa-heart"></i> by <a href="https://github.com/hexagonkt/hexagon/graphs/contributors">OSS contributors</a>. Licensed under <a href="https://github.com/hexagonkt/hexagon/blob/master/license.md">MIT License</a>

          </div>
        
        powered by
        <a href="https://www.mkdocs.org">MkDocs</a>
        and <a href="https://squidfunk.github.io/mkdocs-material/"> Material for MkDocs</a>
        <div class="social-buttons">
          <a
            class="github-button"
            href="https://github.com/hexagonkt/hexagon/"
            data-icon="octicon-star"
            data-show-count="true"
            aria-label="Star hexagonkt/hexagon on GitHub">Star</a>
          <a
            class="github-button"
            href="https://github.com/hexagonkt/hexagon/subscription"
            data-icon="octicon-eye"
            data-show-count="true"
            aria-label="Watch hexagonkt/hexagon on GitHub">Watch</a>
          <a
            class="github-button"
            href="https://github.com/hexagonkt/hexagon/fork"
            data-icon="octicon-git-branch"
            data-show-count="true"
            aria-label="Fork hexagonkt/hexagon on GitHub">Fork</a>
          <a
            class="twitter-share-button"
            href="https://twitter.com/share?text=Hexagon Kotlin toolkit">Tweet</a>
        </div>
      </div>
      
  <div class="md-footer-social">
    <link rel="stylesheet" href="../assets/fonts/font-awesome.css">
    
      <a href="https://github.com/hexagonkt/hexagon" target="_blank" rel="noopener" title="github" class="md-footer-social__link fa fa-github"></a>
    
      <a href="https://twitter.com/hexagon_kt" target="_blank" rel="noopener" title="twitter" class="md-footer-social__link fa fa-twitter"></a>
    
      <a href="https://kotlinlang.slack.com/messages/hexagon" target="_blank" rel="noopener" title="slack" class="md-footer-social__link fa fa-slack"></a>
    
  </div>

    </div>
  </div>
</footer>
      
    </div>
    
      <script src="../assets/javascripts/application.df00da5d.js"></script>
      
      <script>app.initialize({version:"1.0.4",url:{base:".."}})</script>
      
        <script src="https://buttons.github.io/buttons.js"></script>
      
        <script src="https://platform.twitter.com/widgets.js"></script>
      
    
  </body>
</html>